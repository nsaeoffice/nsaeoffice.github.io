---
import { type CollectionEntry, getCollection } from "astro:content";
import { Image } from "astro:assets";
import PageLayout from "@/layouts/PageLayout.astro";
import Badge from "@/components/astro/Badge.astro";
import { SITE_TITLE } from "../../consts";

import ArrowLeft from "@tabler/icons/outline/arrow-left.svg";
import UsersGroup from "@tabler/icons/outline/users-group.svg";

export async function getStaticPaths() {
  const committees = await getCollection("committees", ({ data }) => {
    // In production, filter out drafts.
    return import.meta.env.MODE !== "production" || data.draft === false;
  });

  return committees.map((committee) => ({
    params: { slug: committee.id },
    props: committee,
  }));
}
type Props = CollectionEntry<"committees">;

const committee = Astro.props;
const members = committee.data.committeeMembers;

function formatPosition(position: string) {
  return position
    .split("-")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");
}
---

<PageLayout
  title={`${committee.data.title} | ${SITE_TITLE}`}
  description={`Meet the members of the ${committee.data.title}`}
>
  <article class="py-8 space-y-10">
    <a
      href="/past-committee/page/1"
      class="px-4 inline-flex items-center gap-2 font-mono text-xs uppercase tracking-widest text-muted-foreground hover:text-primary transition-colors mb-4"
    >
      <ArrowLeft class="size-4" /> Back to Committees
    </a>
    <header class="flex flex-col text-center gap-6 mb-16">
      <div class="space-y-4 items-center">
        <Badge
          variant={"secondary"}
          size={"sm"}
          class="font-mono text-xs uppercase tracking-widest"
        >
          Committee
        </Badge>
        <h1
          class="font-sans text-4xl md:text-6xl font-medium tracking-tighter text-balance"
        >
          {committee.data.title}
        </h1>
        <div
          class="flex items-center justify-center gap-2 text-muted-foreground"
        >
          <UsersGroup class="size-5" />
          <span class="font-mono text-xs uppercase tracking-widest">
            {members.length} Members
          </span>
        </div>
      </div>
    </header>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
      {
        members.map((member) => (
          <div class="relative overflow-hidden rounded-lg shadow-lg group">
            {member.profileImage ? (
              <Image
                src={member.profileImage}
                inferSize
                alt={`Profile picture of ${member.name}`}
                class="aspect-3/4 w-full object-cover transition-transform duration-300 group-hover:scale-105"
              />
            ) : (
              <div class="aspect-3/4 w-full bg-secondary flex items-center justify-center" />
            )}

            <div class="absolute bottom-4 right-4 bg-black/70 p-3 rounded-md text-white">
              <span class="block text-sm font-semibold">{member.name}</span>
              <span class="block text-xs">
                {formatPosition(member.position)}
              </span>
            </div>
          </div>
        ))
      }
    </div>
  </article>
</PageLayout>
