---
import { type CollectionEntry, getCollection, render } from "astro:content";
import PageLayout from "@/layouts/PageLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import Badge from "@/components/astro/Badge.astro";
import ArrowLeft from "@tabler/icons/outline/arrow-left.svg";
import Download from "@tabler/icons/outline/download.svg";
import Point from "@tabler/icons/outline/point.svg";
import MapPin from "@tabler/icons/outline/map-pin.svg";
import CalendarWeek from "@tabler/icons/outline/calendar-week.svg";

export async function getStaticPaths() {
  const posts = await getCollection("minutes");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

type Props = CollectionEntry<"minutes">;
const post = Astro.props;
const { Content } = await render(post);
const {
  title,
  pubDate,
  type,
  location,
  chairperson,
  secretary,
  attendees,
  downloadUrl,
} = post.data;
---

<PageLayout title={title} description={`Minutes for ${title}`}>
  <article class="py-8 space-y-10">
    <a
      href="/minutes"
      class="px-4 inline-flex items-center gap-2 font-mono text-xs uppercase tracking-widest text-muted-foreground hover:text-primary transition-colors"
    >
      <ArrowLeft class="size-4" /> Back to All Minutes
    </a>
    <header class="space-y-8 border-b border-border/50 pb-8">
      <div class="space-y-4 text-center">
        <div class="flex flex-wrap items-center gap-4 justify-center">
          <Badge
            variant={"secondary"}
            size={"xs"}
            class={"font-mono text-xs uppercase tracking-wider flex items-center gap-1.5"}
          >
            <Point class="fill-destructive text-destructive w-2.5 h-2.5" />
            {type}
          </Badge>
          <span
            class="flex flex-row gap-1.5 items-center font-mono text-xs text-muted-foreground uppercase tracking-wider"
          >
            <CalendarWeek class={"size-4"} />
            <FormattedDate date={pubDate} />
          </span>
          <span
            class="flex flex-row gap-1.5 items-center font-mono text-xs text-muted-foreground uppercase tracking-wider"
          >
            <MapPin class={"size-4"} />
            {location}
          </span>
        </div>
        <h1
          class="font-sans text-3xl md:text-5xl font-medium tracking-tighter first-letter:capitalize"
        >
          {title}
        </h1>
      </div>

      <div
        class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 bg-secondary/50 p-6 rounded-xl border border-border/50"
      >
        {
          chairperson && (
            <div>
              <span class="font-mono text-xs text-muted-foreground uppercase tracking-wider block mb-1.5">
                Chairperson
              </span>
              <span class="font-sans font-medium text-lg text-foreground">
                {chairperson}
              </span>
            </div>
          )
        }
        {
          secretary && (
            <div>
              <span class="font-mono text-xs text-muted-foreground uppercase tracking-wider block mb-1.5">
                Secretary
              </span>
              <span class="font-sans font-medium text-lg text-foreground">
                {secretary}
              </span>
            </div>
          )
        }
        {
          attendees && attendees.length > 0 && (
            <div class="md:col-span-2">
              <span class="font-mono text-xs text-muted-foreground uppercase tracking-wider block mb-1.5">
                Attendees
              </span>
              <span class="font-sans text-muted-foreground leading-relaxed">
                {attendees.join(", ")}
              </span>
            </div>
          )
        }
      </div>

      {
        downloadUrl && (
          <div class="flex justify-center pt-2">
            <a
              href={downloadUrl}
              target="_blank"
              class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors font-mono text-xs uppercase tracking-widest"
            >
              <Download class="size-4" /> Download PDF
            </a>
          </div>
        )
      }
    </header>

    <div class="prose max-w-7xl mx-auto dark:prose-invert">
      <Content />
    </div>
  </article>
</PageLayout>
